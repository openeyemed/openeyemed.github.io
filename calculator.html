<!DOCTYPE html>
<html>
<head>
    <title>Investment Calculator</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <h1>Investment Calculator</h1>
    <form id="calculator-form">
        <label for="investorShares">Investor's Shares:</label>
        <input type="number" id="investorShares" name="investorShares" min="1" max="2000000">
        <br>

        <label for="netProfit">Quarterly Net Profit After Reserves & Taxes*</label>
        <input type="number" id="netProfit" name="netProfit">
        <br>

        <label for="term">Term (in years):</label>
        <select id="term" name="term">
            <option value="1">1</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4</option>
            <option value="5">5</option>
        </select>
        <br>

        <input type="button" value="Calculate" onclick="calculateInvestment()">
    </form>

    <p>*This refers to the first quarterly profit period total. A CAGR of 25% will be used for illustration purposes.</p>

    <h2>Results</h2>
    <div id="results"></div>
    <div id="quarterlyText"></div>
    <div id="totalPaid"></div>
    <canvas id="distributionChart" width="400" height="200"></canvas>

    <h2>Shareholder's Potential Valuation of Shares</h2>
    <div id="yearlyText"></div>
    <canvas id="valuationChart" width="400" height="200"></canvas>

    <script>
        function formatNumber(num) {
            return num.toLocaleString('en-US', {maximumFractionDigits: 2});
        }

        function calculateInvestment() {
            console.log("Function called");  // Debugging line

            const investorShares = parseFloat(document.getElementById("investorShares").value);
            const netProfit = parseFloat(document.getElementById("netProfit").value);
            const term = parseInt(document.getElementById("term").value);
            const totalQuarters = term * 4;
            const totalYears = term;

            console.log("Investor Shares: ", investorShares);  // Debugging line
            console.log("Net Profit: ", netProfit);  // Debugging line
            console.log("Term: ", term);  // Debugging line

            // Calculate quarterly distributions
            let quarterlyDistributions = [];
            let quarterlyProfit = netProfit;
            for (let i = 0; i < totalQuarters; i++) {
                const distribution = (investorShares / 2000000) * quarterlyProfit;
                quarterlyDistributions.push(distribution);
                quarterlyProfit *= Math.pow(1 + 0.25, 1 / 4);
            }

            // Calculate yearly valuations
            let yearlyValuations = [];
            let yearlyProfit = netProfit * 4;
            for (let i = 0; i <= totalYears; i++) {
                const valuation = yearlyProfit * 4;
                yearlyValuations.push(valuation);
                yearlyProfit *= 1.25;
            }

            // Display results
            document.getElementById("results").innerText = `Your quarterly distribution will be $${formatNumber(quarterlyDistributions[0])} based on your ownership.`;
            document.getElementById("quarterlyText").innerText = `Quarterly Distributions: ${quarterlyDistributions.map((q, i) => `Q${i + 1}: $${formatNumber(q)}`).join(", ")}`;
            document.getElementById("totalPaid").innerText = `Total Paid to Investor: $${formatNumber(quarterlyDistributions.reduce((a, b) => a + b, 0))}`;
            document.getElementById("yearlyText").innerText = `Yearly Valuations: ${yearlyValuations.map((y, i) => `Year ${i + 1}: $${formatNumber(y)}`).join(", ")}`;

            // Plot the graphs
            const distributionCtx = document.getElementById('distributionChart').getContext('2d');
            const valuationCtx = document.getElementById('valuationChart').getContext('2d');

            new Chart(distributionCtx, {
                type: 'line',
                data: {
                    labels: Array.from({length: totalQuarters}, (_, i) => `Q${i + 1}`),
                    datasets: [{
                        label: 'Quarterly Distributions',
                        data: quarterlyDistributions,
                        borderColor: 'rgba(75, 192, 192, 1)',
                        fill: false
                    }]
                }
            });

            new Chart(valuationCtx, {
                type: 'line',
                data: {
                    labels: Array.from({length: totalYears + 1}, (_, i) => `Year ${i + 1}`),
                    datasets: [{
                        label: 'Yearly Valuation',
                        data: yearlyValuations,
                        borderColor: 'rgba(255, 99, 132, 1)',
                        fill: false
                    }]
                }
            });
        }
    </script>
</body>
</html>
